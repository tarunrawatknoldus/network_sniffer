<!DOCTYPE html>
<html>
<head>
    <title>Database Records</title>
    <link rel="stylesheet" type="text/css" href="/static/styles.css"> <!-- Link to the CSS file -->
</head>
<body>
    <h1>Database Records</h1>

    <label for="filter">Filter:</label>
    <input type="text" id="filter" placeholder="Enter filter text...">
    <button onclick="applyFilter()">Apply Filter</button>

    <table id="data-table">
        <tr>
            <th>Source IP</th>
            <th>Destination IP</th>
            <th>Source Port</th>
            <th>Destination Port</th>
            <th>Sequence Number</th>
            <th>Acknowledgment Number</th>
            <th>Flags</th>
            <th>Window Size</th>
        </tr>
    </table>

    <div id="pagination">
        <button onclick="prevPage()">Previous</button>
        <span id="page-num">1</span>
        <button onclick="nextPage()">Next</button>
    </div>

    <script>
        let data = []; // Variable to hold the fetched data
        let currentPage = 1;
        const itemsPerPage = 10;

        async function fetchData() {
            const response = await fetch("/json"); // Update the URL to match the API route in the Rust code
            data = await response.json();

            renderData();
        }

        function renderData() {
            const filterText = document.getElementById("filter").value.trim().toLowerCase();
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;

            const table = document.getElementById("data-table");
            table.innerHTML = "<tr><th>Source IP</th><th>Destination IP</th><th>Source Port</th><th>Destination Port</th><th>Sequence Number</th><th>Acknowledgment Number</th><th>Flags</th><th>Window Size</th></tr>";

            let rowCount = 0;

            for (const record of data) {
                const srcIp = record.src_ip || "-";
                const dstIp = record.dst_ip || "-";

                if (filterText && !srcIp.toLowerCase().includes(filterText) && !dstIp.toLowerCase().includes(filterText)) {
                    continue;
                }

                if (rowCount >= startIndex && rowCount < endIndex) {
                    const newRow = document.createElement("tr");

                    newRow.innerHTML = `<td>${srcIp}</td><td>${dstIp}</td><td>${record.src_port}</td><td>${record.dst_port}</td><td>${record.seq_number}</td><td>${record.ack_number}</td><td>${record.flags}</td><td>${record.window_size}</td>`;
                    table.appendChild(newRow);
                }

                rowCount++;
            }

            const pageNum = document.getElementById("page-num");
            pageNum.innerText = currentPage;
        }

        function applyFilter() {
            currentPage = 1;
            renderData();
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderData();
            }
        }

        function nextPage() {
            const maxPage = Math.ceil(data.length / itemsPerPage);

            if (currentPage < maxPage) {
                currentPage++;
                renderData();
            }
        }

        fetchData();
    </script>
</body>
</html>
